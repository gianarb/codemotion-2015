<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Wordpress Scalability with Docker</title>

		<meta name="description" content="Change the current status of our server, full of wordpress installations. Isolate and scale them with docker">
		<meta name="author" content="Gianluca Arbezzano">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="css/theme/white.css" id="theme">

		<!-- Code syntax highlighting -->
        <link rel="stylesheet" href="css/github.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
        <link rel="stylesheet" href="css/mine.css">
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section data-background="img/cover.jpg">
					<h1>Wordpress</h1>
					<h3>Scalability with Docker</h3>
					<p>
						<small>Created by <a href="http://gianarb.it">Gianluca Arbezzano</a></small>
					</p>
				</section>

				<section data-background="img/page.jpg">
                    <table>
                        <tr>
                            <td style="text-align:left;width:40%;vertical-align: top;">
                                <img src="img/cav.jpg"/>
                            </td>
                            <td>
                                <p>Gianluca Arbezzano</p>
                                <p>Full Stack Developer</p>
                                <p>Maintainer Doctrine Module and open source contributor</p>
                                <hr/>
                                <p><a href="https://github.com/gianarb" target="_blank">github.com/gianarb</a></p>
                                <p><a href="https://twitter.com/gianarb" target="_blank">twitter.com/gianarb</a></p>
                            </td>
                        </tr>
                    </table>
				</section>

				<section data-background="img/page.jpg">
					<h1>Keywords</h1>
				</section>

				<section data-background="img/page.jpg">
					<h1>Isolation</h1>
                    <p class="fragment" data-fragment-index="1">
                        To increase control of system
                    </p>
				</section>

				<section data-background="img/page.jpg">
					<h1>Isolation</h1>
                    <p>To mitigate the security issue</p>
				</section>

				<section data-background="img/page.jpg">
					<h1>Isolation</h1>
                    <p>To gurantee scalability</p>
				</section>

                <section data-state="scale-state" data-background="img/page.jpg" id="scaleSlide">
                    <h2>Scalability</h2>
                    <div style="height:220px">
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div style="display:block; margin-top: 5px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <div class="ec2" style="display:inline-block; margin: 0 5px; width: 100px; height: 100px;"></div>
                    <h3 class="message"></h3>
                    </div>
                </section>

				<section data-background="img/page.jpg">
                    <h2>What is scalabily?</h2>
                    <p><strong>Scalability <=> High avalability.</strong></p>
                    <blockquote>Scalability is the ability of a system, network, or process to handle a growing amount
                        of work in a capable manner or its ability to be enlarged to accommodate that growth.
                        </br></br><i>cit. Wikipedia.</i>
                    </blockquote>
				</section>

				<section data-background="img/page.jpg">
                    <h2>There are two types of scalability</h2>
				</section>

				<section data-background="img/page.jpg">
                    <h3>Vertical scalability</h3>
                    <img src="img/sumo.jpg" style="width:50%"/>
				</section>

				<section data-background="img/page.jpg">
                    <h3>Horizontal scalability</h3>
                    <img src="img/infr.png"/>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Hourly metric</h2>
                    <img src="img/day-day.png"/>
				</section>

				<section data-background="img/page.jpg">
                    <h3>The traffic is a peaks's issue</h3>
                    <img src="img/scale.png" width="70%" />
				</section>

				<section data-background="img/page.jpg">
                    <h3>Your server supports all traffic ALWAYS</h3>
                    <img src="img/provision1.png" width="70%" />
				</section>

				<section data-background="img/page.jpg">
                    <p>
                        The differce between this peaks for a lot of time is unused
                    </p>
                    <img src="img/provision3.png"/>
				</section>

				<section data-background="img/page.jpg">
                    <h2>you pay it!</h2>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Our infrastructure</h2>
                    <img src="img/infra-wp.png">
				</section>

				<section data-background="img/page.jpg">
                    <h2>There are other problems</h2>
                    <img data-fragment-index="1" class="fragment" width="45%" src="img/disaster.jpg">
                    <p data-fragment-index="1" class="fragment" src="img/disaster.png">Disaster recovery</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Your switchboard scale?</h2>
                    <img width="55%" src="img/switchboard.jpg">
				</section>

				<section data-background="img/page.jpg">
                    <h2>There are other problems</h2>
                    <ul>
                        <li data-fragment-index="1" class="fragment">Isolation</p>
                        <li data-fragment-index="2" class="fragment">Scalability</p>
                        <li data-fragment-index="3" class="fragment">Monitoring</p>
                        <li data-fragment-index="4" class="fragment">freedom and security</p>
                    </ul>
				</section>

				<section data-background="img/page.jpg">
                    <h2>we submerged by problems</h2>
                    <img data-fragment-index="1" class="fragment" src="img/problem.png">
                    <p data-fragment-index="1" class="fragment" >and we hide a lot of them!</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Choice your environment</h2>
                    <img width="75%" src="img/wp-bench.jpg">
                    <p style="font-size:0.5em">by <a href="https://www.digitalocean.com/company/blog/getting-ready-for-php-7/">DigitalOcean - Erika Heidi</a></p>
				</section>

                <section>
                    <p>I know what you think..</p>
                    <blockquote class="fragment" data-fragment-index="1">Each application require its server!
                    <small>cit. strong sysadmin</small>
                    </blockquote>
                    <p class="fragment" data-fragment-index="2"><strong>I am here to apply this concept at your experience</strong></p>
                </section>

				<section data-background="img/page.jpg">
                    <h2>Why AWS?</h2>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Elastic Container Service</h2>
                    <img src="img/ecs.png">
				</section>

				<section data-background="img/page.jpg">
                    <h2>Elastic <span style="font-size:1.3em;color:red;">Container</span> Service</h2>
                    <img src="img/ecs.png">
				</section>

				<section data-background="img/page.jpg">
                    <h2>Linux Container <small>LXC</small></h2>
                    <p>it is an operating-system-level virtualization environment for running multiple
                    isolated Linux systems (containers) on a single Linux control host.</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Linux Container <small>LXC</small></h2>
                    <p>it is an operating-system-level virtualization environment for running multiple
                    <strong>isolated</strong> Linux systems (containers) on a single Linux control host.</p>
                    <p class="fragment" data-fragment-index="1"><strong>I love Wikipedia</strong></p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Docker</h2>
                    <p>Docker containers wrap up a piece of software in a complete
                    filesystem that contains everything it needs to run: code, runtime, system tools,
                    system libraries – anything you can install on a server</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Docker</h2>
                    <pre><code lang="bash">
Commands:
    attach    Attach to a running container
    build     Build an image from a Dockerfile
    images    List images
    kill      Kill a running container
    logs      Fetch the logs of a container
    ps        List containers
    restart   Restart a container
    rm        Remove one or more containers
    rmi       Remove one or more images
    run       Run a command in a new container
    search    Search the Docker Hub for images
    start     Start one or more stopped containers
    stop      Stop a running container
                    </code></pre>
				</section>
				<section data-background="img/page.jpg">
                    <h2>MySQL - dockerfile</h2>
                    <pre><code lang="dockerfile">
FROM ubuntu

RUN dpkg-divert --local --rename --add /sbin/initctl
RUN ln -s /bin/true /sbin/initctl

RUN echo "deb http://archive.ubuntu.com/ubuntu precise main universe" > /etc/apt/sources.list
RUN apt-get update

RUN apt-get -y install mysql-server

EXPOSE 3306

CMD ["/usr/bin/mysqld_safe"]
                    </code></pre>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Apache - dockerfile</h2>
                    <pre><code lang="dockerfile">
FROM php:5.6-apache
RUN a2enmod rewrite

RUN apt-get update && apt-get install -y libpng12-dev libjpeg-dev
    && rm -rf /var/lib/apt/lists/* \
    && docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr \
    && docker-php-ext-install gd
RUN docker-php-ext-install mysqli
VOLUME /var/www/html
RUN curl -o wordpress.tar.gz -SL https://wordpress.org/wordpress.tar.gz \
    && tar -xzf wordpress.tar.gz -C /usr/src/ \
    && rm wordpress.tar.gz \
    && chown -R www-data:www-data /usr/src/wordpress
CMD ["apache2-foreground"]
                    </code></pre>
				</section>

                <section>
                    <h2>Create mysql container</h2>
                    <pre><code>
docker build -t gianarb/mysql .
                    </code></pre>
                    <p>Same stuff for wordpress</p>
                </section>

                <section>
                    <h2>Run all</h2>
                    <pre><code>
docker run -t db -p 3306:3306 gianarb/mysql
                    </code></pre>
                    <pre lang="bash"><code lang="bash">
docker run -p 8080:80 -d --name wp1 --link mysql:mysql  wordpress
                    </code></pre>
                </section>

                <section>
                    <h2>docker compose</h2>
                    <p>Compose is a tool for defining and running
                    multi-container Docker applications.
                    With Compose, you use a Compose file to configure
                    your application’s services.</p>
                </section>

                <section>
                    <h2>docker compose</h2>
                    <pre><code>
wp:
  image: wordpress
  ports:
    - 8081:80
  environment:
      WORDPRESS_DB_HOST: mysql
      WORDPRESS_DB_USER: root
      WORDPRESS_DB_PASSWORD: help_me
  links:
    - mysql:mysql
mysql:
  image: mysql:5.7
  environment:
    MYSQL_ROOT_PASSWORD: help_me
                    </code></pre>
                </section>

                <section>
                    <h2>docker compose</h2>
                    <pre><code>
Commands:
  build              Build or rebuild services
  logs               View output from containers
  ps                 List containers
  pull               Pulls service images
  restart            Restart services
  rm                 Remove stopped containers
  run                Run a one-off command
  scale              Set number of containers for a service
  start              Start services
  stop               Stop services
  up                 Create and start containers
                    </code></pre>
                </section>

				<section data-background="img/page.jpg">
                    <h2>Elastic Container Service</h2>
                    <p>it is a highly scalable, fast, container management service that makes it
                    easy to run, stop, and manage Docker containers
                    on a cluster of Amazon EC2 instances<p>
                    <p style="font-size:0.5em">by <a href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html">AWS</a></p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Elastic Container Service</h2>
                    <p><strong>Container instance: </strong> An Amazon EC2 that is running the Amazon ECS Agent.
                    It has been registered to <strong>ECS Cluster</strong></p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Elastic Container Service</h2>
                    <p><strong>Cluster: </strong> It is a pool of <strong>Container instances</strong></p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Elastic Container Service</h2>
                    <p><strong>Task definition: </strong> A description of an application that contains
                    one or more <strong>container definitions</strong></p>
                    <pre><code lang="json">
{
    "family": "",
    "containerDefinitions": [
    }
}
                    </code></pre>
                    <p data-fragment-index="1" class="fragment">Each Task definition running is a <strong>Task</strong></p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>ECS in practice</h2>
                    <pre><code>
ecs-cli configure \
    --region eu-west-1 \
    --cluster wps \
    --access-key apikey \
    --secret-key secreyKey
                    </pre></code>
                    <p>Create your cluster and confiugre your cli</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>ECS in practice</h2>
                    <pre><code>
ecs-cli up --keypair codemotion-ecs \
    --capability-iam \
    --size 1 \
    --instance-type t2.medium
                    </pre></code>
                    <p>Configure Cluster and start first EC2</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>ECS in practice</h2>
                    <pre><code>
ecs-cli compose --file docker-compose.yml  \
    --project-name wp1 up
                    </pre></code>
                    <p>Up your first wordpress task, wp1</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>ECS in practice</h2>
                    <pre><code>
ecs-cli ps
                    </pre></code>
                    <p>See status of your tasks</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>ECS in practice</h2>
                    <pre><code>
COMMANDS:
   configure    Configures your AWS credentials
   up           Create the ECS Cluster
   down         Delete the ECS Cluster and associated resources
   scale        Modify the number of container instances.
   ps           List all of the running containers.
   compose      Execute docker-compose style commands
                on an ECS cluster.
   help, h      Shows a list of commands or help for one command
                    </pre></code>
                    <p class="fragment" data-fragment-index="1">docker-compose style commands?!</p>
				</section>

				<section data-background="img/page.jpg">
                    <p>Now we have 2 wordpress that run on different ports 8080 and 8081</p>
                    <p class="fragment" data-fragment-index="1">Our problem are not finished</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>HAProxy helps you</h2>
                    <p>
                     high availability, load balancing, and proxying for TCP and HTTP-based applications.
                     It is particularly suited for very high traffic web sites and powers quite a
                     number of the world's most visited ones.
                    </p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>HAProxy helps you</h2>
                    <pre><code>
...
frontend wp_mananger
        bind :80
        acl host_wp1 hdr(host) -i wp1.gianarb.it
        acl host_wp2 hdr(host) -i wp2.gianarb.it
        use_backend backend_wp1 if host_wp1
        use_backend backend_wp2 if host_wp2
backend backend_wp1
        server server1 54.229.190.73:8080 check
backend backend_wp2
        server server2 54.229.190.73:8081 check
                    </code></pre>
                    <p class="fragment" data-fragment-index="1">Maybe this is not the best solution</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Nginx could be a Reverse Proxy</h2>
                    <img src="img/nginx.png" width="50%">
				</section>

				<section data-background="img/page.jpg">
                    <h2>Consul</h2>
                    <img src="img/consul.png" width="50%">
				</section>

				<section data-background="img/page.jpg">
                    <p>AWS! AWS! AWS!</p>
                    <p data-fragment-index="1" class="fragment"><img src="img/funboy.png"></p>
                    <h2 data-fragment-index="1" class="fragment">You are only a fun boy!</h2>
				</section>

				<section data-background="img/page.jpg">
                    <img src="img/kubernetes.png">
                    <p>Manage a cluster of Linux containers as a single system to accelerate Dev and simplify Ops.</p>
				</section>

				<section data-background="img/page.jpg">
                    <img src="img/kubernetes-01.svg" width="40%">
                    <p>Kubernetes is an open source orchestration system for Docker containers.</p>
				</section>

				<section data-background="img/page.jpg">
                    <img src="img/swarm.png" width="40%">
                    <p>Docker Swarm is native clustering for Docker.
                    It allows you create and access to a pool of Docker hosts using the full suite of Docker tools</p>
				</section>

				<section data-background="img/page.jpg">
                    <img src="img/coreos.png" width="30%">
                    <p>Instead of installing packages via yum or apt, CoreOS uses Linux containers to manage your services at a higher level of abstraction</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Try Elastic Container Service</h2>
                    <p><a href="http://amzn.to/1SbwgcG">amzn.to/1SbwgcG</a></p>
                    <p>Take your coupon</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Where is your wordpress?!</h2>
                    <h4 style="text-align:right">I don't know</h4>
                    <p class="fragment" data-fragment-inex="1">It'll not more a bad response</p>
				</section>

				<section data-background="img/page.jpg">
                    <h2>Credits:</h2>
                    <ul>
                        <li><a href="http://engineering.facile.it/from-development-to-production-with-docker-and-amazon-ecs/" target="_blank">engineering.facile.it</a></li>
                        <li><a href="http://docs.aws.amazon.com/cli/latest/reference/ecs/index.html" target="_blank">docs.aws.amazon.com/cli</a></li>
                        <li><a href="https://docs.docker.com/compose/production/" target="_blank">docs.docker.com/compose</a></li>
                        <li><a href="http://www.haproxy.org/" target="_blank">haproxy.org</a></li>
                        <li><a href="https://www.youtube.com/playlist?list=PLkA60AVN3hh87OoVra6MHf2L4UR9xwJkv" target="_blank">youtube.com/docker</a></li>
                    </ul>
				</section>

				<section data-background="img/end.jpg">
					<h3>Thanks!</h3>
                    <img src="img/qrcode.jpg"/>
                    <p><a href="https://joind.in/16327">joind.in/16327</a></p>
					<p style="font-size:1em;">
                        <a href="https://github.com/gianarb" target="_blank"><icon class="fa fa-github"></icon></a>
                        <a href="https://twitter.com/gianarb" target="_blank"><icon class="fa fa-twitter"></icon></a>
					</p>
					<p>
                    <small><a href="http://gianarb.it" target="_blank">gianarb.it</a></small>
					</p>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script src="node_modules/jquery/dist/jquery.min.js"></script>

		<script>
			Reveal.initialize({
				controls: false,
				progress: true,
				history: true,
				center: true,
				transition: 'none', // none/fade/slide/convex/concave/zoom
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

            Reveal.configure({
                keyboard: {
                  38: "prev",
                  40: "next"
                }
            });
            var timeout = 700;
            Reveal.addEventListener(
                'scale-state',
                function(slide) {
                    setInterval(function(){
                        var ec2Count = $('#scaleSlide .ec2').length;
                        var lottery = parseInt(Math.random() * 1e9) % ec2Count;

                        var selected = $($('#scaleSlide .ec2')[lottery]);
                        if (selected.is(':visible')) {
                            selected.fadeOut();
                        } else {
                            selected.fadeIn();
                        }

                    }, 600);
                },
                false
            );
		</script>


	</body>
</html>
